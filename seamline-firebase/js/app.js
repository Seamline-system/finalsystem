/* =============================================
   SEAMLINE Quotation System â€” app.js
   Firebase Cloud Version
   ============================================= */

import { initializeApp }         from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
import { getAuth, onAuthStateChanged, signOut }
                                  from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
import { getFirestore, collection, addDoc, updateDoc, deleteDoc,
         doc, onSnapshot, query, orderBy, setDoc, getDoc }
                                  from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

// â”€â”€ Firebase Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const firebaseConfig = {
  apiKey:            "AIzaSyBdpScnxFYPAkNUOpsyXI6ZXpyROmtxtt8",
  authDomain:        "seamline-quote-system.firebaseapp.com",
  projectId:         "seamline-quote-system",
  storageBucket:     "seamline-quote-system.firebasestorage.app",
  messagingSenderId: "594336642381",
  appId:             "1:594336642381:web:4bccc94ecbcc5d4ae3f304"
};

const firebaseApp = initializeApp(firebaseConfig);
const auth        = getAuth(firebaseApp);
const db          = getFirestore(firebaseApp);

const { jsPDF } = window.jspdf;

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let items              = [];
let quotes             = [];
let editingId          = null;
let editingDocId       = null;   // Firestore document ID
let designImageBase64  = null;
let currentUser        = null;
let unsubscribeQuotes  = null;   // Firestore listener cleanup
let salesSortMode      = 'revenue'; // 'revenue' | 'profit' | 'orders'

// â”€â”€ Embedded SEAMLINE Logo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SEAMLINE_LOGO = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAEnA8YDASIAAhEBAxEB/8QAHgABAAICAwEBAQAAAAAAAAAAAAgJAQIGBwoFBAP/xABXEAABAwMCBAMEBgIOBwUFCQABAAIDBAURBgcIEiExCRNBFBkiUTJVYXGV0kLRFRYXI0VSVldicoGRlKEYJDNYk9PUQ4OSlqImNDVjwVNkc4KEo6ay4f/EABgBAQEBAQEAAAAAAAAAAAAAAAABAgME/8QAIhEBAQACAgIDAAMBAAAAAAAAAAECERIxIUEDE1EiMmFx/9oADAMBAAIRAxEAPwC1NERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBEXXm82/8AtJsBp52o909Y0doic0mmpc+ZV1jgD8MMDcveSRjOOUZ+IgdUHYa/nUVEFJBJVVU8cMMLHSSSSODWsaBkuJPQADqSVU5vr4vu4V+qai0bBaWptL25ri2O73aJlXXygE4c2E5giyMZa4S/eoSbhb0bs7sVpr9yNxdQail7NbXV0kkUYznDI88jBkno0ALnfkk6amNX36n4qOGzR0TpdQb66Hp3MeGOhjvdPPMCf/lRuc/HzPLgeq4UfEI4Nwcfu52np/8Acqz/AJKoRRZ+2rxegOwccnCRqWrZRW7fvSsUkhcGmvqHULMhuTl9Q1jR07ZPU9Bk9F2npbcHQOuWyO0VrewagbEA6Q2u5w1YYD2J8tzsDqF5qV/WmqqmjmbUUdRLBKzq2SN5a4fcR1T7acXpxRef7bnji4q9r3RM05vPf6ql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8N1Df3T/AAj/AFZqr8bd+VPdP8I/1Zqr8bd+VTIROM/DdQ390/wj/Vmqvxt35U90/wAI/wBWaq/G3flUyETjPw3UOPdQcI4/gzVX4278qe6g4SPq3VX4278qmOiccfw3UOPdQcJH1bqr8bd+VPdQcJH1bqr8bd+VTHROGP4bqH1H4U/CJTVcFTNYtSVUcUjXugmvcgjlAOSx3IGu5T2PK4HB6EHqpb2u2W+y2yks1ppI6WhoII6amgjGGRRMaGsY0egDQAPuX6kVkk6TexERUEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERB/9k=';

// â”€â”€ Auth Guard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
onAuthStateChanged(auth, user => {
  if (!user) {
    window.location.href = 'login.html';
    return;
  }
  currentUser = user;
  document.getElementById('userInfo').textContent = user.email;
  init();
  subscribeToQuotes();
});

window.signOutUser = async function() {
  if (unsubscribeQuotes) unsubscribeQuotes();
  await signOut(auth);
  window.location.href = 'login.html';
};

// â”€â”€ Real-time Firestore Listener â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function subscribeToQuotes() {
  const q = query(collection(db, 'quotes'), orderBy('createdAt', 'desc'));
  unsubscribeQuotes = onSnapshot(q, snapshot => {
    quotes = snapshot.docs.map(d => ({ ...d.data(), _docId: d.id }));
    updateCount();
    // Refresh history if open
    const historyPanel = document.getElementById('panel-history');
    if (historyPanel.classList.contains('active')) renderHistory();
    // Refresh sales tracker if open
    const salesPanel = document.getElementById('panel-sales');
    if (salesPanel && salesPanel.classList.contains('active')) renderSalesTracker();
  });
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init() {
  document.getElementById('quoteDate').value = new Date().toISOString().split('T')[0];
  document.getElementById('quoteRef').value  = genRef();
  if (items.length === 0) addItem();
  updateSummary();
}

// â”€â”€ Tab Switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.switchTab = function(tab, btnEl) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p  => p.classList.remove('active'));
  document.getElementById('panel-' + tab).classList.add('active');
  btnEl.classList.add('active');
  if (tab === 'history') renderHistory();
  if (tab === 'sales')   renderSalesTracker();
};

// â”€â”€ Reference Generator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function genRef() {
  const n = quotes.length + 1;
  return `SL-${String(n).padStart(4, '0')}-${new Date().getFullYear()}`;
}

// â”€â”€ Items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addItem = function(data = {}) {
  const id = Date.now() + Math.random();
  items.push({ id, desc: data.desc || '', up: data.up || '', sp: data.sp || '', qty: data.qty || 1 });
  renderItems();
};

function renderItems() {
  const container = document.getElementById('itemsContainer');
  container.innerHTML = items.map(item => `
    <div class="item-row" id="row-${item.id}">
      <input type="text"   placeholder="Item description" value="${item.desc}"    oninput="updateItem(${item.id},'desc',this.value)"/>
      <input type="number" placeholder="0.00"             value="${item.up||''}"  min="0" step="0.01" oninput="updateItem(${item.id},'up',this.value)"/>
      <input type="number" placeholder="0.00"             value="${item.sp||''}"  min="0" step="0.01" oninput="updateItem(${item.id},'sp',this.value)"/>
      <input type="number" placeholder="1"                value="${item.qty}"     min="1" step="1"    oninput="updateItem(${item.id},'qty',this.value)"/>
      <div class="profit-cell ${profitClass(item)}">${profitDisplay(item)}</div>
      <button class="remove-btn" onclick="removeItem(${item.id})" title="Remove">Ã—</button>
    </div>
  `).join('');
  updateSummary();
}

function profitClass(item) {
  return ((parseFloat(item.sp)||0) - (parseFloat(item.up)||0)) >= 0 ? 'profit-pos' : 'profit-neg';
}

function profitDisplay(item) {
  const up = parseFloat(item.up)||0, sp = parseFloat(item.sp)||0;
  if (!up && !sp) return 'â€”';
  const p = sp - up;
  return (p >= 0 ? '+' : '') + 'Rs. ' + p.toFixed(2);
}

window.updateItem = function(id, field, value) {
  const item = items.find(i => i.id === id);
  if (!item) return;
  item[field] = value;
  const row = document.getElementById('row-' + id);
  if (row) {
    const cell = row.querySelector('.profit-cell');
    if (cell) { cell.textContent = profitDisplay(item); cell.className = 'profit-cell ' + profitClass(item); }
  }
  updateSummary();
};

window.removeItem = function(id) {
  if (items.length === 1) { showToast('At least one item is required'); return; }
  items = items.filter(i => i.id !== id);
  renderItems();
};

// â”€â”€ Summary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateSummary() {
  let totalCost = 0, totalRev = 0;
  items.forEach(item => {
    totalCost += (parseFloat(item.up)||0) * (parseInt(item.qty)||0);
    totalRev  += (parseFloat(item.sp)||0) * (parseInt(item.qty)||0);
  });
  const profit = totalRev - totalCost;
  const pct    = totalRev > 0 ? ((profit/totalRev)*100).toFixed(1) : 'â€”';
  document.getElementById('totalCost').textContent    = 'Rs. ' + totalCost.toFixed(2);
  document.getElementById('totalRevenue').textContent = 'Rs. ' + totalRev.toFixed(2);
  document.getElementById('totalProfit').textContent  = (profit>=0?'+':'') + 'Rs. ' + profit.toFixed(2);
  document.getElementById('totalProfit').className    = 'summary-value ' + (profit>=0?'profit-val':'loss-val');
  document.getElementById('profitMarginText').textContent =
    `SP (Rs.${Math.abs(totalRev).toFixed(2)}) âˆ’ UP (Rs.${Math.abs(totalCost).toFixed(2)}) = ${profit>=0?'+':''}Rs.${profit.toFixed(2)}`;
  document.getElementById('marginPct').textContent = totalRev > 0 ? pct + '%' : 'â€”';
}

// â”€â”€ Save Quote to Firestore â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.saveQuote = async function() {
  const client = document.getElementById('clientName').value.trim();
  if (!client) { showToast('Please enter a client name'); return; }
  if (!items.filter(i => i.desc||i.up||i.sp).length) { showToast('Please add at least one item'); return; }

  let totalCost = 0, totalRev = 0;
  items.forEach(item => {
    totalCost += (parseFloat(item.up)||0) * (parseInt(item.qty)||0);
    totalRev  += (parseFloat(item.sp)||0) * (parseInt(item.qty)||0);
  });

  const statusRadio = document.querySelector('input[name="orderStatus"]:checked');
  const orderStatus = statusRadio ? statusRadio.value : 'pending';

  const quote = {
    ref:         document.getElementById('quoteRef').value,
    client,
    contact:     document.getElementById('clientContact').value,
    date:        document.getElementById('quoteDate').value,
    notes:       document.getElementById('quoteNotes').value,
    items:       JSON.parse(JSON.stringify(items)),
    totalCost,
    totalRev,
    profit:      totalRev - totalCost,
    pct:         totalRev > 0 ? ((totalRev-totalCost)/totalRev*100).toFixed(1) : 0,
    createdAt:   new Date().toISOString(),
    createdBy:   currentUser.email,
    designImage: designImageBase64 || null,
    status:      orderStatus,
  };

  showSaving(true);
  try {
    if (editingDocId) {
      await updateDoc(doc(db, 'quotes', editingDocId), quote);
      showToast('âœ“ Quote updated!');
    } else {
      await addDoc(collection(db, 'quotes'), quote);
      showToast('âœ“ Quote saved to cloud!');
    }
    clearForm();
    updateCount();
  } catch(e) {
    console.error(e);
    showToast('âŒ Error saving â€” check connection');
  }
  showSaving(false);
};

// â”€â”€ Clear Form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.clearForm = function() {
  document.getElementById('clientName').value    = '';
  document.getElementById('clientContact').value = '';
  document.getElementById('quoteNotes').value    = '';
  document.getElementById('quoteDate').value     = new Date().toISOString().split('T')[0];
  document.getElementById('quoteRef').value      = genRef();
  items = []; editingId = null; editingDocId = null;
  removeDesign();
  addItem();
};

function updateCount() {
  const n = quotes.length;
  document.getElementById('quoteCount').textContent = n + ' quote' + (n!==1?'s':'');
}

// â”€â”€ History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderHistory() {
  const container = document.getElementById('historyContainer');
  if (quotes.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="icon">ğŸ—‚</div><h3>No quotes yet</h3><p>Create your first quotation to see it here.</p></div>`;
    return;
  }
  container.innerHTML = quotes.map(q => {
    const status = q.status || 'pending';
    const statusLabel = status === 'approved' ? 'âœ“ Approved' : status === 'rejected' ? 'âœ• Rejected' : 'â³ Pending';
    return `
    <div class="quote-card">
      <div class="quote-card-header">
        <div>
          <div class="quote-num">${q.ref} <span class="status-badge ${status}">${statusLabel}</span></div>
          <div class="quote-date">${q.client} Â· ${q.contact||'No contact'} Â· ${formatDate(q.date)}
            <span style="margin-left:8px;color:#777;font-size:11px;">by ${q.createdBy||'unknown'}</span>
          </div>
        </div>
        <span class="quote-badge ${q.profit>=0?'badge-profit':'badge-loss'}">${q.profit>=0?'â–² Profit':'â–¼ Loss'}</span>
      </div>
      <div class="quote-stats">
        <div class="stat"><div class="stat-label">Total Cost</div><div class="stat-val">Rs. ${(q.totalCost||0).toFixed(2)}</div></div>
        <div class="stat"><div class="stat-label">Total Revenue</div><div class="stat-val">Rs. ${(q.totalRev||0).toFixed(2)}</div></div>
        <div class="stat"><div class="stat-label">Profit</div><div class="stat-val" style="color:${q.profit>=0?'var(--success)':'var(--danger)'}">
          ${q.profit>=0?'+':''}Rs. ${Math.abs(q.profit||0).toFixed(2)}</div></div>
        <div class="stat"><div class="stat-label">Margin %</div><div class="stat-val">${q.pct}%</div></div>
      </div>
      <div class="quote-card-actions">
        <button class="mini-btn" onclick="editQuote('${q._docId}')">âœï¸ Edit</button>
        <button class="mini-btn" onclick="pdfFromHistory('${q._docId}')">ğŸ“„ PDF</button>
        <button class="mini-btn del" onclick="deleteQuote('${q._docId}')">ğŸ—‘ Delete</button>
        <div class="status-changer">
          <select onchange="updateQuoteStatus('${q._docId}', this.value)" title="Change Status">
            <option value="pending"  ${status==='pending' ?'selected':''}>â³ Pending</option>
            <option value="approved" ${status==='approved'?'selected':''}>âœ“ Approved</option>
            <option value="rejected" ${status==='rejected'?'selected':''}>âœ• Rejected</option>
          </select>
        </div>
      </div>
    </div>`;
  }).join('');
}

function formatDate(d) {
  if (!d) return '';
  const [y,m,day] = d.split('-');
  return `${day}/${m}/${y}`;
}

window.editQuote = function(docId) {
  const q = quotes.find(q => q._docId === docId);
  if (!q) return;
  editingDocId = docId;
  document.getElementById('clientName').value    = q.client;
  document.getElementById('clientContact').value = q.contact || '';
  document.getElementById('quoteDate').value     = q.date;
  document.getElementById('quoteNotes').value    = q.notes || '';
  document.getElementById('quoteRef').value      = q.ref;
  items = JSON.parse(JSON.stringify(q.items));
  renderItems();
  // Restore status
  const statusVal = q.status || 'pending';
  const statusRadio = document.querySelector(`input[name="orderStatus"][value="${statusVal}"]`);
  if (statusRadio) statusRadio.checked = true;
  if (q.designImage) {
    designImageBase64 = q.designImage;
    const preview = document.getElementById('designPreview');
    preview.src = q.designImage; preview.style.display = 'block';
    document.getElementById('uploadPlaceholder').style.display = 'none';
    document.getElementById('designUploadArea').classList.add('has-image');
    document.getElementById('designUploadArea').style.cursor = 'default';
    document.getElementById('designUploadArea').onclick = null;
    document.getElementById('removeDesignBtn').style.display = 'inline-block';
  }
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p  => p.classList.remove('active'));
  document.getElementById('panel-new').classList.add('active');
  document.querySelector('.tab-btn').classList.add('active');
  showToast('âœï¸ Editing quote ' + q.ref);
};

window.deleteQuote = async function(docId) {
  if (!confirm('Delete this quote?')) return;
  try {
    await deleteDoc(doc(db, 'quotes', docId));
    showToast('Quote deleted');
  } catch(e) { showToast('Error deleting quote'); }
};

window.clearAll = async function() {
  if (!confirm('Delete ALL quotes? This cannot be undone.')) return;
  try {
    const deletes = quotes.map(q => deleteDoc(doc(db, 'quotes', q._docId)));
    await Promise.all(deletes);
    showToast('All quotes cleared');
  } catch(e) { showToast('Error clearing quotes'); }
};

// â”€â”€ Design Image â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.handleDesignUpload = function(event) {
  const file = event.target.files[0];
  if (!file) return;
  if (!['image/png','image/jpeg','image/jpg'].includes(file.type)) {
    showToast('Please upload a PNG or JPG image'); return;
  }
  const reader = new FileReader();
  reader.onload = e => {
    designImageBase64 = e.target.result;
    const preview = document.getElementById('designPreview');
    const area    = document.getElementById('designUploadArea');
    preview.src = designImageBase64; preview.style.display = 'block';
    document.getElementById('uploadPlaceholder').style.display = 'none';
    area.classList.add('has-image'); area.style.cursor = 'default'; area.onclick = null;
    document.getElementById('removeDesignBtn').style.display = 'inline-block';
    showToast('âœ“ Design image uploaded!');
  };
  reader.readAsDataURL(file);
};

window.removeDesign = function() {
  designImageBase64 = null;
  const preview = document.getElementById('designPreview');
  const area    = document.getElementById('designUploadArea');
  if (!preview) return;
  preview.src = ''; preview.style.display = 'none';
  document.getElementById('uploadPlaceholder').style.display = 'block';
  area.classList.remove('has-image'); area.style.cursor = 'pointer';
  area.onclick = () => document.getElementById('designImageInput').click();
  document.getElementById('removeDesignBtn').style.display = 'none';
  document.getElementById('designImageInput').value = '';
};

// â”€â”€ PDF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildPDFData() {
  let totalCost = 0, totalRev = 0;
  items.forEach(item => {
    totalCost += (parseFloat(item.up)||0) * (parseInt(item.qty)||0);
    totalRev  += (parseFloat(item.sp)||0) * (parseInt(item.qty)||0);
  });
  return {
    ref: document.getElementById('quoteRef').value,
    client: document.getElementById('clientName').value || 'N/A',
    contact: document.getElementById('clientContact').value || '',
    date: document.getElementById('quoteDate').value,
    notes: document.getElementById('quoteNotes').value || '',
    items, totalCost, totalRev,
    profit: totalRev - totalCost,
    pct: totalRev > 0 ? ((totalRev-totalCost)/totalRev*100).toFixed(1) : 0,
    designImage: designImageBase64 || null,
  };
}

window.generatePDF = function(data) {
  const d   = data || buildPDFData();
  const doc = new jsPDF({ unit: 'mm', format: 'a4' });
  const W = 210, M = 15;

  doc.setFillColor(255,255,255);
  doc.rect(0,0,W,297,'F');

  // Logo box
  const logoBoxX=M, logoBoxY=12, logoBoxW=72, logoBoxH=30;
  doc.setDrawColor(0,0,0); doc.setLineWidth(1.5);
  doc.rect(logoBoxX,logoBoxY,logoBoxW,logoBoxH,'S');
  const logoPad=3, maxLogoW=logoBoxW-logoPad*2, maxLogoH=logoBoxH-logoPad*2;
  const logoAspect=3.5;
  let fitW=maxLogoW, fitH=fitW/logoAspect;
  if (fitH>maxLogoH) { fitH=maxLogoH; fitW=fitH*logoAspect; }
  const logoImgX=logoBoxX+(logoBoxW-fitW)/2, logoImgY=logoBoxY+(logoBoxH-fitH)/2;
  try { doc.addImage(SEAMLINE_LOGO,'JPEG',logoImgX,logoImgY,fitW,fitH); }
  catch(e) {
    doc.setFont('helvetica','bolditalic'); doc.setFontSize(22); doc.setTextColor(0,0,0);
    doc.text('SEAMLINE',logoBoxX+logoBoxW/2,logoBoxY+logoBoxH/2+3,{align:'center'});
  }

  // Watermark
  try {
    doc.saveGraphicsState();
    doc.setGState(new doc.GState({opacity:0.07}));
    const wmW=140, wmH=wmW/3.5;
    doc.addImage(SEAMLINE_LOGO,'JPEG',W/2-wmW/2,297/2-wmH/2-45,wmW,wmH);
    doc.restoreGraphicsState();
  } catch(e) {}

  // Billed To / Date
  doc.setFont('helvetica','bold'); doc.setFontSize(11); doc.setTextColor(0,0,0);
  doc.text('Billed To:',120,22);
  doc.setFont('helvetica','normal'); doc.setFontSize(11);
  doc.text(d.client||'',120,29);
  if (d.contact) doc.text(d.contact,120,35);
  doc.setFont('helvetica','bold'); doc.setFontSize(11);
  doc.text('Date:',120,46);
  doc.setFont('helvetica','normal');
  doc.text(d.date?formatDate(d.date):'',134,46);

  // QUOTATION heading
  doc.setFont('helvetica','bold'); doc.setFontSize(18); doc.setTextColor(0,0,0);
  doc.text('QUOTATION',W/2,64,{align:'center'});

  // Table
  const tableTop=70, tableW=W-M*2, tableR=M+tableW, rowH=10;
  const colTotalR=tableR-4, colPriceR=colTotalR-52, colQtyR=colPriceR-46;
  const colDescL=M+4, colDescR=colQtyR-5;

  doc.setFillColor(0,0,0); doc.rect(M,tableTop,tableW,rowH,'F');
  doc.setFont('helvetica','bold'); doc.setFontSize(9); doc.setTextColor(255,255,255);
  doc.text('ITEM DESCRIPTION',colDescL,tableTop+6.5);
  doc.text('QTY',colQtyR,tableTop+6.5,{align:'right'});
  doc.text('PRICE (RS)',colPriceR,tableTop+6.5,{align:'right'});
  doc.text('TOTAL',colTotalR,tableTop+6.5,{align:'right'});

  const itemsBoxTop=tableTop+rowH+4, itemRowH=12;
  const itemsBoxH=d.items.length*itemRowH+16+14;
  doc.setDrawColor(0,0,0); doc.setLineWidth(0.8);
  doc.rect(M,itemsBoxTop,tableW,itemsBoxH,'S');

  let y=itemsBoxTop+9;
  d.items.forEach(item => {
    const sp=parseFloat(item.sp)||0, qty=parseInt(item.qty)||1, total=sp*qty;
    doc.setFont('helvetica','normal'); doc.setFontSize(10); doc.setTextColor(0,0,0);
    const clipped=doc.splitTextToSize(item.desc||'â€”',colDescR-colDescL)[0];
    doc.text(clipped,colDescL,y);
    doc.text(String(qty),colQtyR,y,{align:'right'});
    doc.text('Rs. '+sp.toFixed(2),colPriceR,y,{align:'right'});
    doc.text('Rs. '+total.toFixed(2),colTotalR,y,{align:'right'});
    y+=itemRowH;
  });

  const dividerY=itemsBoxTop+itemsBoxH-16;
  doc.setDrawColor(0,0,0); doc.setLineWidth(0.4);
  doc.line(M+4,dividerY,M+tableW-4,dividerY);
  const totalY=dividerY+10;
  doc.setFont('helvetica','bold'); doc.setFontSize(11); doc.setTextColor(0,0,0);
  doc.text('TOTAL',colPriceR,totalY,{align:'right'});
  doc.text('Rs. '+d.totalRev.toFixed(2),colTotalR,totalY,{align:'right'});

  // Advance note
  const afterBox=itemsBoxTop+itemsBoxH+2;
  doc.setFont('helvetica','bold'); doc.setFontSize(9); doc.setTextColor(0,0,0);
  doc.text('*An advance of 50% of the total must be settled in order to begin production*',W/2,afterBox+10,{align:'center'});

  // Design/Drafts
  const draftsY=afterBox+20;
  doc.setFont('helvetica','bold'); doc.setFontSize(13); doc.setTextColor(0,0,0);
  doc.text('Design/Drafts',M,draftsY);
  const hasImage=d.designImage&&d.designImage.length>0;
  const draftsBoxY=draftsY+5, draftsBoxH=hasImage?100:65;
  doc.setDrawColor(0,0,0); doc.setLineWidth(0.8);
  doc.rect(M,draftsBoxY,tableW,draftsBoxH,'S');
  if (hasImage) {
    const imgPad=4, imgX=M+imgPad, imgW=tableW-imgPad*2, imgH=draftsBoxH-imgPad*2;
    let imgFormat='JPEG';
    if (d.designImage.startsWith('data:image/png')) imgFormat='PNG';
    try { doc.addImage(d.designImage,imgFormat,imgX,draftsBoxY+imgPad,imgW,imgH,'','FAST'); }
    catch(e) { try { doc.addImage(d.designImage,'',imgX,draftsBoxY+imgPad,imgW,imgH); } catch(e2){} }
    if (d.notes) {
      doc.setFillColor(255,255,255);
      doc.rect(M+imgPad,draftsBoxY+draftsBoxH-12,tableW-imgPad*2,10,'F');
      doc.setFont('helvetica','italic'); doc.setFontSize(8); doc.setTextColor(80,80,80);
      doc.text(d.notes,M+imgPad+2,draftsBoxY+draftsBoxH-5);
    }
  } else if (d.notes) {
    doc.setFont('helvetica','normal'); doc.setFontSize(9); doc.setTextColor(0,0,0);
    doc.text(doc.splitTextToSize(d.notes,tableW-8),M+4,draftsBoxY+8);
  }

  // Footer
  const footerBoxY=draftsBoxY+draftsBoxH+10;
  doc.setDrawColor(0,0,0); doc.setLineWidth(0.8);
  doc.rect(M,footerBoxY,tableW,14,'S');
  doc.setFont('helvetica','normal'); doc.setFontSize(10); doc.setTextColor(0,0,0);
  doc.text('team@atseamline.com',W/2,footerBoxY+9,{align:'center'});

  doc.save(`${d.ref}_${d.client.replace(/\s/g,'_')}.pdf`);
  showToast('ğŸ“„ PDF exported!');
};

window.pdfFromHistory = function(docId) {
  const q = quotes.find(q => q._docId === docId);
  if (!q) return;
  generatePDF(q);
};

// â”€â”€ Update Quote Status from History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.updateQuoteStatus = async function(docId, newStatus) {
  try {
    await updateDoc(doc(db, 'quotes', docId), { status: newStatus });
    const label = newStatus === 'approved' ? 'âœ“ Approved' : newStatus === 'rejected' ? 'âœ• Rejected' : 'â³ Pending';
    showToast(`Status updated: ${label}`);
  } catch(e) {
    showToast('Error updating status');
  }
};

// â”€â”€ Sales Tracker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getApprovedByPeriod() {
  const period = document.getElementById('periodSelect')?.value || 'all';
  const now = new Date();
  return quotes.filter(q => {
    if ((q.status || 'pending') !== 'approved') return false;
    if (period === 'all') return true;
    const d = new Date(q.date || q.createdAt);
    if (period === 'month') {
      return d.getFullYear() === now.getFullYear() && d.getMonth() === now.getMonth();
    }
    if (period === 'lastmonth') {
      const lm = new Date(now.getFullYear(), now.getMonth() - 1, 1);
      return d.getFullYear() === lm.getFullYear() && d.getMonth() === lm.getMonth();
    }
    if (period === 'year') {
      return d.getFullYear() === now.getFullYear();
    }
    return true;
  });
}

window.renderSalesTracker = function() {
  const approved = getApprovedByPeriod();

  // â”€â”€ KPIs
  const totalRev    = approved.reduce((s,q) => s + (q.totalRev||0), 0);
  const totalProfit = approved.reduce((s,q) => s + (q.profit||0), 0);
  const orderCount  = approved.length;
  const avgOrder    = orderCount > 0 ? totalRev / orderCount : 0;
  const margin      = totalRev > 0 ? (totalProfit / totalRev * 100) : 0;
  const clients     = new Set(approved.map(q => q.client)).size;

  document.getElementById('kpi-revenue').textContent = 'Rs. ' + totalRev.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
  document.getElementById('kpi-profit').textContent  = 'Rs. ' + totalProfit.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
  document.getElementById('kpi-orders').textContent  = orderCount;
  document.getElementById('kpi-avg').textContent     = 'Rs. ' + avgOrder.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
  document.getElementById('kpi-margin').textContent  = margin.toFixed(1) + '%';
  document.getElementById('kpi-clients').textContent = clients;

  buildMonthlyChart(approved);
  buildTopClientsChart(approved);
  buildClientProfiles(approved);
};

function buildMonthlyChart(approved) {
  const container = document.getElementById('monthlyChart');
  if (!approved.length) {
    container.innerHTML = '<div class="chart-empty">No approved orders in this period.</div>';
    return;
  }

  // Group by year-month
  const monthMap = {};
  approved.forEach(q => {
    const d = new Date(q.date || q.createdAt);
    const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
    const label = d.toLocaleString('default', {month:'short'});
    if (!monthMap[key]) monthMap[key] = { label, rev: 0, profit: 0 };
    monthMap[key].rev    += q.totalRev || 0;
    monthMap[key].profit += q.profit   || 0;
  });

  const months = Object.keys(monthMap).sort();
  const maxRev = Math.max(...months.map(k => monthMap[k].rev), 1);
  const CHART_H = 180; // px

  container.innerHTML = months.map(k => {
    const m = monthMap[k];
    const revH    = Math.max(Math.round((m.rev    / maxRev) * CHART_H), 2);
    const profitH = Math.max(Math.round((Math.max(m.profit,0) / maxRev) * CHART_H), 2);
    return `
      <div class="month-group">
        <div class="month-bars">
          <div class="bar bar-rev" style="height:${revH}px;">
            <div class="bar-tooltip">Rev: Rs.${m.rev.toFixed(0)}</div>
          </div>
          <div class="bar bar-profit" style="height:${profitH}px;">
            <div class="bar-tooltip">Profit: Rs.${m.profit.toFixed(0)}</div>
          </div>
        </div>
        <div class="month-label">${m.label}</div>
      </div>`;
  }).join('');
}

function buildTopClientsChart(approved) {
  const container = document.getElementById('topClientsChart');
  if (!approved.length) {
    container.innerHTML = '<div class="chart-empty">No data yet.</div>';
    return;
  }

  const clientMap = {};
  approved.forEach(q => {
    if (!clientMap[q.client]) clientMap[q.client] = 0;
    clientMap[q.client] += q.totalRev || 0;
  });

  const sorted = Object.entries(clientMap).sort((a,b) => b[1]-a[1]).slice(0, 5);
  const maxRev = sorted[0]?.[1] || 1;

  container.innerHTML = sorted.map(([name, rev]) => {
    const pct = Math.round((rev / maxRev) * 100);
    return `
      <div class="client-bar-row">
        <div class="client-bar-meta">
          <div class="client-bar-name">${name}</div>
          <div class="client-bar-value">Rs.${rev.toLocaleString('en-US',{maximumFractionDigits:0})}</div>
        </div>
        <div class="client-bar-track">
          <div class="client-bar-fill" style="width:${pct}%;"></div>
        </div>
      </div>`;
  }).join('');
}

function buildClientProfiles(approved) {
  const container = document.getElementById('clientProfilesTable');
  if (!approved.length) {
    container.innerHTML = '<div class="chart-empty" style="padding:40px;">No approved orders found.</div>';
    return;
  }

  const clientMap = {};
  approved.forEach(q => {
    if (!clientMap[q.client]) clientMap[q.client] = { name: q.client, orders: 0, revenue: 0, profit: 0 };
    clientMap[q.client].orders++;
    clientMap[q.client].revenue += q.totalRev  || 0;
    clientMap[q.client].profit  += q.profit    || 0;
  });

  let sorted = Object.values(clientMap);
  if (salesSortMode === 'revenue') sorted.sort((a,b) => b.revenue - a.revenue);
  if (salesSortMode === 'profit')  sorted.sort((a,b) => b.profit  - a.profit);
  if (salesSortMode === 'orders')  sorted.sort((a,b) => b.orders  - a.orders);

  const maxRev = sorted[0]?.revenue || 1;

  const rows = sorted.map((c, i) => {
    const margin = c.revenue > 0 ? (c.profit / c.revenue * 100).toFixed(1) : '0.0';
    const barPct = Math.round((c.revenue / maxRev) * 100);
    return `
      <tr>
        <td class="cp-rank ${i===0?'cp-rank-1':''}">#${i+1}</td>
        <td class="cp-client-name">${c.name}</td>
        <td class="cp-revenue">
          <div class="cp-rev-bar-wrap">
            <span>Rs.${c.revenue.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
            <div class="cp-rev-bar-track"><div class="cp-rev-bar-fill" style="width:${barPct}%;"></div></div>
          </div>
        </td>
        <td class="cp-profit">Rs.${c.profit.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}</td>
        <td class="cp-margin">${margin}%</td>
        <td class="cp-orders">${c.orders}</td>
      </tr>`;
  }).join('');

  container.innerHTML = `
    <table class="cp-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Client</th>
          <th>Revenue</th>
          <th>Profit</th>
          <th>Margin</th>
          <th style="text-align:center;">Orders</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>`;
}

window.setSortMode = function(mode, btn) {
  salesSortMode = mode;
  document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const approved = getApprovedByPeriod();
  buildClientProfiles(approved);
};

// â”€â”€ Saving indicator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showSaving(on) {
  let el = document.getElementById('savingIndicator');
  if (!el) {
    el = document.createElement('div');
    el.id = 'savingIndicator';
    el.className = 'saving-indicator';
    el.textContent = 'â˜ Saving to cloud...';
    document.body.appendChild(el);
  }
  el.classList.toggle('show', on);
}

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.showToast = function(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
};
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLIENT DIRECTORY SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let clients            = [];
let editingClientDocId = null;
let unsubscribeClients = null;

// â”€â”€ Subscribe to clients collection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function subscribeToClients() {
  try {
    const q = query(collection(db, 'clients'), orderBy('name', 'asc'));
    unsubscribeClients = onSnapshot(q, snapshot => {
      clients = snapshot.docs.map(d => ({ ...d.data(), _docId: d.id }));
      // Refresh clients tab if open
      const panel = document.getElementById('panel-clients');
      if (panel && panel.classList.contains('active')) renderClientDirectory();
    }, err => {
      console.error('Clients listener error:', err);
      if (err.code === 'permission-denied') {
        const container = document.getElementById('clientDirectoryContainer');
        if (container) {
          container.innerHTML = `
            <div style="padding:32px;border:2px solid var(--danger);background:#fff8f8;color:var(--danger);">
              <strong>Firestore Permission Error</strong><br><br>
              Update your Firestore rules in Firebase Console â†’ Firestore â†’ Rules:<br><br>
              <code style="font-size:12px;background:#f0f0f0;padding:8px;display:block;margin-top:8px;">
                rules_version = '2';<br>
                service cloud.firestore {<br>
                &nbsp;&nbsp;match /databases/{database}/documents {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;match /{collection}/{docId} {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow read, write: if request.auth != null;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;}<br>
                }
              </code>
            </div>`;
        }
      }
    });
  } catch(e) { console.error('subscribeToClients error:', e); }
}

// â”€â”€ Tab switch â€” hook into existing switchTab â”€â”€
const _origSwitchTab = window.switchTab;
window.switchTab = function(tab, btnEl) {
  _origSwitchTab(tab, btnEl);
  if (tab === 'clients') renderClientDirectory();
};

// â”€â”€ Sign-out cleanup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _origSignOut = window.signOutUser;
window.signOutUser = async function() {
  if (unsubscribeClients) unsubscribeClients();
  await _origSignOut();
};

// â”€â”€ Kick off clients listener when auth is ready
// (we re-use the onAuthStateChanged side-effect; just call after init)
const _origInit = typeof init === 'function' ? init : null;
// Actually hook into the existing onAuthStateChanged by calling subscribeToClients after quotes
(function patchAuth() {
  // subscribeToClients will be called by patching subscribeToQuotes' callback
  // Simplest: call it directly since auth is already set up
  const checkAndSubscribe = () => {
    if (currentUser) { subscribeToClients(); }
    else { setTimeout(checkAndSubscribe, 200); }
  };
  setTimeout(checkAndSubscribe, 500);
})();

// â”€â”€ Render Client Directory â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.renderClientDirectory = function() {
  const container = document.getElementById('clientDirectoryContainer');
  if (!container) return;

  const search = (document.getElementById('clientDirSearch')?.value || '').toLowerCase();
  let filtered = clients;
  if (search) {
    filtered = clients.filter(c =>
      (c.name       || '').toLowerCase().includes(search) ||
      (c.contact    || '').toLowerCase().includes(search) ||
      (c.email      || '').toLowerCase().includes(search)
    );
  }

  if (!filtered.length) {
    container.innerHTML = `<div class="chart-empty" style="padding:60px 0;">${
      search ? 'No clients match your search.' : 'No clients yet. Add your first client above.'
    }</div>`;
    return;
  }

  container.innerHTML = filtered.map(c => {
    // Aggregate stats from quotes
    const cQuotes    = quotes.filter(q => (q.client||'').toLowerCase() === (c.name||'').toLowerCase());
    const cApproved  = cQuotes.filter(q => q.status === 'approved');
    const cRevenue   = cApproved.reduce((s,q) => s + (q.totalRev||0), 0);
    const cProfit    = cApproved.reduce((s,q) => s + (q.profit||0), 0);

    return `
    <div class="client-dir-card">
      <div class="client-dir-card-header">
        <div class="client-dir-name">${c.name}</div>
        <div class="client-dir-actions">
          <button class="mini-btn" onclick="startQuoteForClient('${c._docId}')">âœ¦ New Quote</button>
          <button class="mini-btn" onclick="openClientModal('${c._docId}')">âœï¸ Edit</button>
          <button class="mini-btn del" onclick="deleteClient('${c._docId}')">ğŸ—‘</button>
        </div>
      </div>
      <div class="client-dir-details">
        ${c.contact ? `<span>ğŸ‘¤ ${c.contact}</span>` : ''}
        ${c.phone   ? `<span>ğŸ“ ${c.phone}</span>`   : ''}
        ${c.email   ? `<span>âœ‰ï¸ ${c.email}</span>`   : ''}
        ${c.address ? `<span>ğŸ“ ${c.address}</span>` : ''}
      </div>
      ${c.notes ? `<div class="client-dir-notes">${c.notes}</div>` : ''}
      <div class="client-dir-stats">
        <div class="cds-item"><div class="cds-label">Total Quotes</div><div class="cds-value">${cQuotes.length}</div></div>
        <div class="cds-item"><div class="cds-label">Approved</div><div class="cds-value">${cApproved.length}</div></div>
        <div class="cds-item"><div class="cds-label">Revenue</div><div class="cds-value">Rs.${cRevenue.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}</div></div>
        <div class="cds-item"><div class="cds-label">Profit</div><div class="cds-value" style="color:var(--success)">Rs.${cProfit.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}</div></div>
      </div>
    </div>`;
  }).join('');
};

// â”€â”€ Modal Open / Close â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.openClientModal = function(docId) {
  editingClientDocId = docId || null;
  document.getElementById('clientModalTitle').textContent = docId ? 'Edit Client' : 'Add Client';
  // Clear fields
  ['cm-name','cm-contact','cm-phone','cm-email','cm-address','cm-notes'].forEach(id => {
    document.getElementById(id).value = '';
  });
  if (docId) {
    const c = clients.find(c => c._docId === docId);
    if (c) {
      document.getElementById('cm-name').value    = c.name    || '';
      document.getElementById('cm-contact').value = c.contact || '';
      document.getElementById('cm-phone').value   = c.phone   || '';
      document.getElementById('cm-email').value   = c.email   || '';
      document.getElementById('cm-address').value = c.address || '';
      document.getElementById('cm-notes').value   = c.notes   || '';
    }
  }
  document.getElementById('clientModal').style.display = 'flex';
};

window.closeClientModal = function(e) {
  if (e && e.target !== document.getElementById('clientModal')) return;
  document.getElementById('clientModal').style.display = 'none';
  editingClientDocId = null;
};

// â”€â”€ Save Client to Firestore â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.saveClient = async function() {
  const name = document.getElementById('cm-name').value.trim();
  if (!name) { showToast('Client name is required'); return; }

  const data = {
    name,
    contact:   document.getElementById('cm-contact').value.trim(),
    phone:     document.getElementById('cm-phone').value.trim(),
    email:     document.getElementById('cm-email').value.trim(),
    address:   document.getElementById('cm-address').value.trim(),
    notes:     document.getElementById('cm-notes').value.trim(),
    updatedAt: new Date().toISOString(),
    updatedBy: currentUser?.email || '',
  };

  try {
    if (editingClientDocId) {
      await updateDoc(doc(db, 'clients', editingClientDocId), data);
      showToast('âœ“ Client updated!');
    } else {
      data.createdAt = new Date().toISOString();
      data.createdBy = currentUser?.email || '';
      await addDoc(collection(db, 'clients'), data);
      showToast('âœ“ Client added!');
    }
    document.getElementById('clientModal').style.display = 'none';
    editingClientDocId = null;
  } catch(e) {
    console.error(e);
    if (e.code === 'permission-denied') {
      showToast('âŒ Permission denied â€” update Firestore rules');
    } else {
      showToast('âŒ Error saving client');
    }
  }
};

// â”€â”€ Delete Client â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.deleteClient = async function(docId) {
  const c = clients.find(c => c._docId === docId);
  const linked = quotes.filter(q => (q.client||'').toLowerCase() === (c?.name||'').toLowerCase());
  const msg = linked.length
    ? `"${c?.name}" has ${linked.length} linked quote(s). Delete client anyway?`
    : `Delete client "${c?.name}"?`;
  if (!confirm(msg)) return;
  try {
    await deleteDoc(doc(db, 'clients', docId));
    showToast('Client deleted');
  } catch(e) { showToast('Error deleting client'); }
};

// â”€â”€ Start a new quote pre-filled for a client â”€â”€
window.startQuoteForClient = function(docId) {
  const c = clients.find(c => c._docId === docId);
  if (!c) return;
  // Switch to New Quote tab
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-new').classList.add('active');
  document.querySelector('.tab-btn').classList.add('active');
  // Pre-fill
  document.getElementById('clientName').value    = c.name    || '';
  document.getElementById('clientContact').value = c.phone || c.email || c.contact || '';
  document.getElementById('quoteDate').value     = new Date().toISOString().split('T')[0];
  document.getElementById('quoteRef').value      = genRef();
  // Reset status to pending
  const pending = document.querySelector('input[name="orderStatus"][value="pending"]');
  if (pending) pending.checked = true;
  showToast(`âœ¦ New quote for ${c.name}`);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLIENT AUTOCOMPLETE â€” New Quote Form
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

window.onClientNameInput = function(val) {
  const dropdown = document.getElementById('clientDropdown');
  if (!dropdown) return;

  const query = val.trim().toLowerCase();

  // Filter clients
  let matches = clients;
  if (query) {
    matches = clients.filter(c =>
      (c.name    || '').toLowerCase().includes(query) ||
      (c.contact || '').toLowerCase().includes(query)
    );
  }

  // Hide if no clients exist yet
  if (!clients.length) { dropdown.style.display = 'none'; return; }

  let html = '';

  // Existing client matches
  if (matches.length) {
    html += matches.map(c => `
      <div class="cd-item" onmousedown="selectClientFromDropdown('${c._docId}')">
        <div class="cd-item-name">${highlight(c.name, query)}</div>
        <div class="cd-item-meta">
          ${c.contact ? `<span>${c.contact}</span>` : ''}
          ${c.phone   ? `<span>${c.phone}</span>`   : ''}
          ${c.email   ? `<span>${c.email}</span>`   : ''}
        </div>
      </div>`).join('');
  } else if (query) {
    html += `<div class="cd-no-match">No client named "<strong>${val}</strong>" â€” just keep typing to use as new client.</div>`;
  }

  dropdown.innerHTML = html;
  dropdown.style.display = html ? 'block' : 'none';
};

window.hideClientDropdown = function() {
  const d = document.getElementById('clientDropdown');
  if (d) d.style.display = 'none';
};

window.selectClientFromDropdown = function(docId) {
  const c = clients.find(c => c._docId === docId);
  if (!c) return;

  // Fill name
  document.getElementById('clientName').value = c.name;

  // Fill contact â€” prefer phone, then email, then contact person name
  const contactVal = c.phone || c.email || c.contact || '';
  document.getElementById('clientContact').value = contactVal;

  // Hide dropdown
  const dropdown = document.getElementById('clientDropdown');
  if (dropdown) dropdown.style.display = 'none';

  showToast(`âœ“ ${c.name} selected`);
};

// Highlight matching text in dropdown
function highlight(text, query) {
  if (!query) return text;
  const idx = text.toLowerCase().indexOf(query);
  if (idx === -1) return text;
  return text.slice(0, idx) +
    `<mark class="cd-highlight">${text.slice(idx, idx + query.length)}</mark>` +
    text.slice(idx + query.length);
}